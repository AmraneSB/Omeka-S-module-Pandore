<h1>Recherche Pandore 3.0</h1>

<form method="get" action="">
    <input type="text" name="q" placeholder="Entrez un nom…" value="<?= $this->escapeHtml($query) ?>" />
    <button type="submit">Rechercher</button>
</form>

<?php if ($query): ?>
    <h2>Résultats pour : <?= $this->escapeHtml($query) ?></h2>

    <!-- Omeka -->
    <h3>Omeka S :</h3>
    <?php if (empty($results['omeka'])): ?>
        <p>Aucun résultat Omeka.</p>
    <?php else: ?>
        <ul>
            <?php foreach ($results['omeka'] as $item): ?>
                <li><?= $this->escapeHtml($item->getTitle()) ?></li>
            <?php endforeach; ?>
        </ul>
    <?php endif; ?>

    <!-- Wikidata -->
    <h3>Wikidata :</h3>
    <?php if (empty($results['wikidata'])): ?>
        <p>Aucun résultat Wikidata.</p>
    <?php else: ?>
        <ul>
            <?php foreach ($results['wikidata'] as $r): ?>
                <li>
                    <strong><?= $this->escapeHtml($r['label']) ?></strong>
                    (ID: <?= $this->escapeHtml($r['id']) ?>)<br>
                    <em><?= $this->escapeHtml($r['description'] ?? 'Aucune description') ?></em><br>

                    <?php if (!empty($r['image'])): ?>
                        <img src="<?= $this->escapeHtml($r['image']) ?>" style="max-width:150px;"><br>
                        <a href="<?= $this->escapeHtml($r['image']) ?>" download>Télécharger l'image</a><br>
                    <?php endif; ?>

                    <?php if (!empty($r['audio'])): ?>
                        <audio controls>
                            <source src="<?= $this->escapeHtml($r['audio']) ?>" type="audio/mpeg">
                            Votre navigateur ne supporte pas le lecteur audio.
                        </audio><br>
                        <a href="<?= $this->escapeHtml($r['audio']) ?>" download>Télécharger audio libre</a><br>
                    <?php endif; ?>
                </li><br>
            <?php endforeach; ?>
        </ul>
    <?php endif; ?>

    <!-- Jamendo (libre) -->
    <h3>Musiques libres (Jamendo)</h3>
    <?php if (empty($results['jamendo'])): ?>
        <p>Aucune musique libre trouvée.</p>
    <?php else: ?>
        <ul>
            <?php foreach ($results['jamendo'] as $track): ?>
                <li>
                    <strong><?= $this->escapeHtml($track['name']) ?></strong> par <?= $this->escapeHtml($track['artist']) ?><br>
                    <audio controls>
                        <source src="<?= $this->escapeHtml($track['audio']) ?>" type="audio/mpeg">
                        Votre navigateur ne supporte pas le lecteur audio.
                    </audio><br>
                    <a href="<?= $this->escapeHtml($track['audio']) ?>" download>Télécharger le morceau</a><br>
                    <a href="<?= $this->escapeHtml($track['url']) ?>" target="_blank">Voir sur Jamendo</a>
                </li><br>
            <?php endforeach; ?>
        </ul>
    <?php endif; ?>

    <!-- Spotify -->
    <h3>Spotify (extraits officiels)</h3>
    <?php if (!empty($results['spotify']['link'])): ?>
        <a href="<?= $this->escapeHtml($results['spotify']['link']) ?>" target="_blank">
            Écouter <?= $this->escapeHtml($query) ?> sur Spotify
        </a>
    <?php endif; ?>
<?php endif; ?>
